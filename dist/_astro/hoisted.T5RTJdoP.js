document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("table-body"),f=document.getElementById("result-count"),x=document.getElementById("column-controls-btn"),v=document.getElementById("column-controls");let d=Array.from(document.querySelectorAll(".instance-row")).map(t=>JSON.parse(t.dataset.instance||"{}")),u="ipv4_ipv6",m="",S="asc";x&&v&&(x.addEventListener("click",()=>{v.classList.toggle("hidden")}),document.addEventListener("click",t=>{!x.contains(t.target)&&!v.contains(t.target)&&v.classList.add("hidden")})),document.querySelectorAll('#column-controls input[type="checkbox"]').forEach(t=>{t.addEventListener("change",r=>{const e=r.target,s=e.id.replace("col-","col-"),n=e.checked;document.querySelectorAll(`.${s}`).forEach(o=>{n?o.classList.remove("hidden"):o.classList.add("hidden")})})}),document.querySelectorAll("th[data-sort]").forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-sort");r&&(m===r?S=S==="asc"?"desc":"asc":S="asc",m=r,k(r,S),g())})});function E(){document.querySelectorAll(".regions-more-trigger").forEach(t=>{const r=t.querySelector(".all-regions-popup");if(!r)return;let e,s;t.addEventListener("mouseenter",()=>{clearTimeout(s),e=setTimeout(()=>{r.classList.remove("invisible")},200)}),t.addEventListener("mouseleave",()=>{clearTimeout(e),s=setTimeout(()=>{r.classList.add("invisible")},300)}),r.addEventListener("mouseenter",()=>{clearTimeout(s)}),r.addEventListener("mouseleave",()=>{s=setTimeout(()=>{r.classList.add("invisible")},300)})})}E(),document.addEventListener("filtersChanged",t=>{const e=t.detail;e.networkOptions?.length===1?u=e.networkOptions[0]:u="ipv4_ipv6",P(e),e.regions?.length&&q(e.regions)});function g(){if(document.querySelectorAll(".sort-icon").forEach(r=>{r.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>',r.classList.remove("text-primary-600"),r.classList.add("text-gray-400")}),m){const r=document.querySelector(`th[data-sort="${m}"] .sort-icon`);r&&(r.classList.remove("text-gray-400"),r.classList.add("text-primary-600"),S==="asc"?r.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4l6 6 6-6"></path>':r.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 16l-6-6-6 6"></path>')}}function k(t,r){const s=Array.from(document.querySelectorAll(".instance-row:not(.hidden)")).map(n=>JSON.parse(n.dataset.instance||"{}"));s.sort((n,i)=>{let o=n[t],c=i[t];if(t.includes(".")){const h=t.split(".");o=h.reduce((C,b)=>C?.[b],n),c=h.reduce((C,b)=>C?.[b],i)}if(o==null&&c==null)return 0;if(o==null)return r==="asc"?1:-1;if(c==null)return r==="asc"?-1:1;if(typeof o=="string"&&typeof c=="string"){const h=o.localeCompare(c);return r==="asc"?h:-h}const a=Number(o),l=Number(c);if(!isNaN(a)&&!isNaN(l))return r==="asc"?a-l:l-a;const p=String(o).localeCompare(String(c));return r==="asc"?p:-p}),T(s)}function q(t){document.querySelectorAll(".regions-container").forEach(e=>{const s=JSON.parse(e.getAttribute("data-regions")||"[]");if(!s.length)return;const n=[...s].sort((i,o)=>{const c=t.some(l=>l===i.country||l===i.code||l===i.region),a=t.some(l=>l===o.country||l===o.code||l===o.region);return c&&!a?-1:!c&&a?1:0});D(e,n)}),E()}function D(t,r){t.innerHTML="";const s=r.slice(0,3),n=Math.max(0,r.length-3);if(s.forEach(i=>{const o=document.createElement("div");o.className="relative group",o.innerHTML=`
          <span class="inline-flex items-center space-x-1 cursor-pointer hover:bg-gray-100 px-1 py-0.5 rounded">
            <img 
              src="https://flagsapi.com/${i.countryCode}/flat/16.png"
              alt="${i.country}"
              class="w-4 h-3 rounded-sm"
              loading="lazy"
            />
            <span class="text-xs">${i.code}</span>
          </span>
          <div class="absolute z-20 invisible group-hover:visible bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-1 whitespace-nowrap">
            <div class="font-medium">${i.city}, ${i.country}</div>
            <div class="text-gray-300">${i.region}</div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
          </div>
        `,t.appendChild(o)}),n>0){const i=document.createElement("div");i.className="relative group cursor-pointer";const o=r.map(c=>`
          <div class="flex items-center space-x-2 py-1">
            <img 
              src="https://flagsapi.com/${c.countryCode}/flat/16.png"
              alt="${c.country}"
              class="w-4 h-3 rounded-sm flex-shrink-0"
              loading="lazy"
            />
            <div class="flex-1 min-w-0">
              <div class="text-xs font-medium text-gray-900 truncate">${c.city}, ${c.country}</div>
              <div class="text-xs text-gray-500 truncate">${c.code} â€¢ ${c.region}</div>
            </div>
          </div>
        `).join("");i.innerHTML=`
          <span class="text-xs text-gray-400 hover:text-gray-600">+${n}</span>
          <div class="all-regions-popup absolute z-30 invisible bg-white border border-gray-200 rounded-lg shadow-lg p-3 bottom-full right-0 mb-2 w-64">
            <div class="text-xs font-medium text-gray-900 mb-2">All Available Regions:</div>
            <div class="grid grid-cols-1 gap-1 max-h-40 overflow-y-auto">
              ${o}
            </div>
            <div class="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-200"></div>
          </div>
        `,i.className="relative regions-more-trigger cursor-pointer",t.appendChild(i)}}function P(t){console.log("Filter object:",t),console.log("Total instances loaded:",d.length),console.log("Sample instances:",d.slice(0,3).map(e=>({instanceType:e.instanceType,type:e.type}))),console.log("Instance types found:",[...new Set(d.map(e=>e.type))]),console.log("Cloud servers found:",d.filter(e=>e.type==="cloud-server").length),console.log("First cloud server:",d.find(e=>e.type==="cloud-server"));const r=d.filter(e=>{if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("DEBUG cx22 filtering step by step:"),t.providers?.length&&!t.providers.includes(e.provider))return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED provider filter"),!1;if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED provider filter"),t.regions?.length){let n=!1;if(e.regionalPricing&&Array.isArray(e.regionalPricing)){const i=[];e.locationDetails&&Array.isArray(e.locationDetails)&&i.push(...e.locationDetails.filter(o=>t.regions.some(c=>c===o.country||c===o.code||c===o.region||c===o.city||c.toLowerCase()===o.country.toLowerCase()||c.toLowerCase()===o.code.toLowerCase()))),n=i.length>0&&i.some(o=>e.regionalPricing.some(c=>c.location===o.code))}else e.locationDetails&&Array.isArray(e.locationDetails)?n=e.locationDetails.some(i=>t.regions.some(o=>o===i.country||o===i.code||o===i.region||o===i.city||o.toLowerCase()===i.country.toLowerCase()||o.toLowerCase()===i.code.toLowerCase())):e.regions&&Array.isArray(e.regions)&&(n=e.regions.some(i=>t.regions.some(o=>o===i||o.toLowerCase()===i.toLowerCase())));if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  Region filter result:",n),!n)return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED region filter"),!1;e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED region filter")}if(t.instanceTypes?.length&&!t.instanceTypes.includes(e.type))return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED instance type filter. Expected:",t.instanceTypes,"Got:",e.type),!1;if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED instance type filter"),t.ipTypes?.length){const n=e.networkType||e.ipType;if(n&&!t.ipTypes.includes(n))return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED IP type filter"),!1}if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED IP type filter"),t.networkOptions?.length){const n=e.networkType||e.networkOptions;if(n&&!t.networkOptions.includes(n))return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED network options filter. Expected:",t.networkOptions,"Got:",n),!1}if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED network options filter"),e.vCPU<t.minVCPU||e.vCPU>t.maxVCPU)return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED vCPU filter. vCPU:",e.vCPU,"Range:",t.minVCPU,"-",t.maxVCPU),!1;if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED vCPU filter"),e.memoryGiB<t.minMemory||e.memoryGiB>t.maxMemory)return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED memory filter. Memory:",e.memoryGiB,"Range:",t.minMemory,"-",t.maxMemory),!1;e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED memory filter");let s=0;if(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  Checking price filter..."),t.regions?.length===1&&e.regionalPricing&&e.locationDetails){const n=t.regions[0],i=e.locationDetails.find(o=>n===o.country||n===o.code||n.toLowerCase()===o.country.toLowerCase()||n.toLowerCase()===o.code.toLowerCase());if(i){const o=e.regionalPricing.find(c=>c.location===i.code);o&&o.hourly_net&&(s=o.hourly_net)}}if(s===0){if(e.networkOptions&&typeof e.networkOptions=="object"){const n=e.networkOptions[u];n&&n.available&&n.hourly!==null&&(s=n.hourly)}s===0&&(s=e.priceUSD_hourly||e.priceEUR_hourly_net||0)}return e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  Final price to check:",s,"vs max price:",t.maxPrice),s>t.maxPrice?(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  FAILED price filter. Price:",s,"Max:",t.maxPrice),!1):(e.type==="cloud-server"&&e.instanceType==="cx22"&&console.log("  PASSED ALL FILTERS! ðŸŽ‰"),!0)});console.log(`Filtered result: ${r.length} instances`),console.log("Filtered examples:",r.slice(0,5).map(e=>({instanceType:e.instanceType,type:e.type}))),T(r),t.regions?.length===1?I(t.regions[0]):U(),f&&(f.textContent=`${r.length} instances`)}function I(t){document.querySelectorAll(".instance-row:not(.hidden)").forEach(r=>{const e=JSON.parse(r.dataset.instance||"{}");if(!e.locationDetails||!e.regionalPricing)return;const s=e.locationDetails.find(n=>t===n.country||t===n.code||t.toLowerCase()===n.country.toLowerCase()||t.toLowerCase()===n.code.toLowerCase());if(s){const n=e.regionalPricing.find(i=>i.location===s.code);if(n){const i=r.querySelector(".pricing-hourly .pricing-value");i&&n.hourly_net&&(i.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(n.hourly_net));const o=r.querySelector(".pricing-monthly .pricing-value");o&&n.monthly_net&&(o.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(n.monthly_net));const c=r.querySelector('[data-network-info="true"]');if(c){const a=c.querySelector(".pricing-description");a&&(a.textContent=`${s.city} pricing`,a.className="text-xs text-blue-600 pricing-description")}if(n.included_traffic||n.traffic_price_per_tb){const a=document.createElement("div");a.className="text-xs text-gray-500 mt-1";let l="";if(n.included_traffic){const p=(n.included_traffic/1099511627776).toFixed(1);l+=`${p}TB included`}if(n.traffic_price_per_tb&&(l&&(l+=", "),l+=`â‚¬${n.traffic_price_per_tb}/TB overage`),l){a.textContent=l;const p=r.querySelector(".pricing-hourly");p&&!p.querySelector(".traffic-info")&&(a.classList.add("traffic-info"),p.appendChild(a))}}}}})}function U(){document.querySelectorAll(".instance-row:not(.hidden)").forEach(t=>{const r=JSON.parse(t.dataset.instance||"{}");t.querySelectorAll(".traffic-info").forEach(o=>o.remove());const s=t.querySelector(".pricing-hourly .pricing-value");if(s){const o=r.priceEUR_hourly_net||r.priceUSD_hourly||0,c=r.priceEUR_hourly_net?"EUR":"USD";s.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:c,minimumFractionDigits:4}).format(o)}const n=t.querySelector(".pricing-monthly .pricing-value");if(n){const o=r.priceEUR_monthly_net||r.priceUSD_monthly||0,c=r.priceEUR_monthly_net?"EUR":"USD";n.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:c,minimumFractionDigits:2}).format(o)}const i=t.querySelector('[data-network-info="true"]');if(i){const o=i.querySelector(".pricing-description");o&&(o.textContent="Standard pricing",o.className="text-xs text-gray-500 pricing-description")}})}function F(){document.querySelectorAll('.instance-row:not([style*="display: none"])').forEach(t=>{const r=JSON.parse(t.dataset.instance||"{}");t.querySelector('[data-network-info="true"]');const e=t.querySelector(".pricing-mode-indicator"),s=t.querySelector(".pricing-description"),n=t.querySelector(".pricing-hourly"),i=t.querySelector(".pricing-monthly");if(r.networkOptions&&typeof r.networkOptions=="object"){const o=r.networkOptions[u];if(o&&o.available){if(e&&(e.textContent=u==="ipv6_only"?"IPv6-only":"IPv4 + IPv6",e.className=`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium pricing-mode-indicator ${u==="ipv6_only"?"bg-green-100 text-green-800":"bg-cyan-100 text-cyan-800"}`),s&&(u==="ipv6_only"&&o.savings?(s.textContent=`Saves â‚¬${o.savings.toFixed(2)}/month`,s.className="text-xs text-green-600 pricing-description"):(s.textContent=o.description||"Standard pricing",s.className="text-xs text-gray-500 pricing-description")),n&&o.hourly!==null){const c=n.querySelector(".pricing-value"),a=n.querySelector(".text-xs.text-orange-600");if(c){const l=o.priceRange?.hourly;if(l&&l.hasVariation){const p=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(l.min),h=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(l.max);c.textContent=`${p} - ${h}`,a&&(a.style.display="")}else c.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(o.hourly),a&&(a.style.display="none")}}if(i&&o.monthly!==null){const c=i.querySelector(".pricing-value"),a=i.querySelector(".text-xs.text-orange-600");if(c){const l=o.priceRange?.monthly;if(l&&l.hasVariation){const p=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(l.min),h=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(l.max);c.textContent=`${p} - ${h}`,a&&(a.style.display="")}else c.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(o.monthly),a&&(a.style.display="none")}}t.style.display=""}else u!=="all"&&u!=="ipv4_ipv6"&&(t.style.display="none")}})}function T(t){y&&(document.querySelectorAll(".instance-row").forEach(r=>{r.style.display="none"}),t.forEach(r=>{const e=Array.from(document.querySelectorAll(".instance-row")).find(s=>{const n=JSON.parse(s.dataset.instance||"{}");return n.instanceType===r.instanceType&&n.provider===r.provider});e&&(e.style.display="",y.appendChild(e))}),F(),E())}});document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("apply-filters"),f=document.getElementById("clear-filters");y&&y.addEventListener("click",A),f&&f.addEventListener("click",_)});function A(){const y=Array.from(document.querySelectorAll('input[name="provider"]:checked')).map(g=>g.value),f=Array.from(document.querySelectorAll('input[name="region"]:checked')).map(g=>g.value),x=Array.from(document.querySelectorAll('input[name="instanceType"]:checked')).map(g=>g.value),v=Array.from(document.querySelectorAll('input[name="ipType"]:checked')).map(g=>g.value),d=Array.from(document.querySelectorAll('input[name="networkOption"]:checked')).map(g=>g.value),u=parseInt(document.querySelector('input[name="minVCPU"]')?.value||"0"),m=parseInt(document.querySelector('input[name="maxVCPU"]')?.value||"999"),S=parseInt(document.querySelector('input[name="minMemory"]')?.value||"0"),w=parseInt(document.querySelector('input[name="maxMemory"]')?.value||"9999"),L=parseFloat(document.querySelector('input[name="maxPrice"]')?.value||"999"),E=new CustomEvent("filtersChanged",{detail:{providers:y,regions:f,instanceTypes:x,ipTypes:v,networkOptions:d,minVCPU:u,maxVCPU:m,minMemory:S,maxMemory:w,maxPrice:L}});document.dispatchEvent(E)}function _(){document.querySelectorAll('input[type="checkbox"]').forEach(u=>{const m=u;m.name==="region"?m.checked=m.value==="Germany"||m.value==="germany":m.checked=!0});const y=document.querySelector('input[name="minVCPU"]'),f=document.querySelector('input[name="maxVCPU"]'),x=document.querySelector('input[name="minMemory"]'),v=document.querySelector('input[name="maxMemory"]'),d=document.querySelector('input[name="maxPrice"]');y&&(y.value=y.min),f&&(f.value=f.max),x&&(x.value=x.min),v&&(v.value=v.max),d&&(d.value=d.max),A()}
