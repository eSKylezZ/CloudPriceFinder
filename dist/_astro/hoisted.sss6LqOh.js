document.addEventListener("DOMContentLoaded",()=>{const p=document.getElementById("table-body"),y=document.getElementById("result-count"),h=document.getElementById("column-controls-btn"),g=document.getElementById("column-controls");let x=Array.from(document.querySelectorAll(".instance-row")).map(t=>JSON.parse(t.dataset.instance||"{}")),u="ipv4_ipv6",m="",S="asc";h&&g&&(h.addEventListener("click",()=>{g.classList.toggle("hidden")}),document.addEventListener("click",t=>{!h.contains(t.target)&&!g.contains(t.target)&&g.classList.add("hidden")})),document.querySelectorAll('#column-controls input[type="checkbox"]').forEach(t=>{t.addEventListener("change",o=>{const n=o.target,s=n.id.replace("col-","col-"),r=n.checked;document.querySelectorAll(`.${s}`).forEach(e=>{r?e.classList.remove("hidden"):e.classList.add("hidden")})})}),document.querySelectorAll("th[data-sort]").forEach(t=>{t.addEventListener("click",()=>{const o=t.getAttribute("data-sort");o&&(m===o?S=S==="asc"?"desc":"asc":S="asc",m=o,A(o,S),f())})});function b(){document.querySelectorAll(".regions-more-trigger").forEach(t=>{const o=t.querySelector(".all-regions-popup");if(!o)return;let n,s;t.addEventListener("mouseenter",()=>{clearTimeout(s),n=setTimeout(()=>{o.classList.remove("invisible")},200)}),t.addEventListener("mouseleave",()=>{clearTimeout(n),s=setTimeout(()=>{o.classList.add("invisible")},300)}),o.addEventListener("mouseenter",()=>{clearTimeout(s)}),o.addEventListener("mouseleave",()=>{s=setTimeout(()=>{o.classList.add("invisible")},300)})})}b(),document.addEventListener("filtersChanged",t=>{const n=t.detail;n.networkOptions?.length===1?u=n.networkOptions[0]:u="ipv4_ipv6",I(n),n.regions?.length&&U(n.regions)});function f(){if(document.querySelectorAll(".sort-icon").forEach(o=>{o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>',o.classList.remove("text-primary-600"),o.classList.add("text-gray-400")}),m){const o=document.querySelector(`th[data-sort="${m}"] .sort-icon`);o&&(o.classList.remove("text-gray-400"),o.classList.add("text-primary-600"),S==="asc"?o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4l6 6 6-6"></path>':o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 16l-6-6-6 6"></path>')}}function A(t,o){const s=Array.from(document.querySelectorAll(".instance-row:not(.hidden)")).map(r=>JSON.parse(r.dataset.instance||"{}"));s.sort((r,i)=>{let e=r[t],c=i[t];if(t.includes(".")){const v=t.split(".");e=v.reduce((C,w)=>C?.[w],r),c=v.reduce((C,w)=>C?.[w],i)}if(e==null&&c==null)return 0;if(e==null)return o==="asc"?1:-1;if(c==null)return o==="asc"?-1:1;if(typeof e=="string"&&typeof c=="string"){const v=e.localeCompare(c);return o==="asc"?v:-v}const l=Number(e),a=Number(c);if(!isNaN(l)&&!isNaN(a))return o==="asc"?l-a:a-l;const d=String(e).localeCompare(String(c));return o==="asc"?d:-d}),k(s)}function U(t){document.querySelectorAll(".regions-container").forEach(n=>{const s=JSON.parse(n.getAttribute("data-regions")||"[]");if(!s.length)return;const r=[...s].sort((i,e)=>{const c=t.some(a=>a===i.country||a===i.code||a===i.region),l=t.some(a=>a===e.country||a===e.code||a===e.region);return c&&!l?-1:!c&&l?1:0});T(n,r)}),b()}function T(t,o){t.innerHTML="";const s=o.slice(0,3),r=Math.max(0,o.length-3);if(s.forEach(i=>{const e=document.createElement("div");e.className="relative group",e.innerHTML=`
          <span class="inline-flex items-center space-x-1 cursor-pointer hover:bg-gray-100 px-1 py-0.5 rounded">
            <img 
              src="https://flagsapi.com/${i.countryCode}/flat/16.png"
              alt="${i.country}"
              class="w-4 h-3 rounded-sm"
              loading="lazy"
            />
            <span class="text-xs">${i.code}</span>
          </span>
          <div class="absolute z-20 invisible group-hover:visible bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-1 whitespace-nowrap">
            <div class="font-medium">${i.city}, ${i.country}</div>
            <div class="text-gray-300">${i.region}</div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
          </div>
        `,t.appendChild(e)}),r>0){const i=document.createElement("div");i.className="relative group cursor-pointer";const e=o.map(c=>`
          <div class="flex items-center space-x-2 py-1">
            <img 
              src="https://flagsapi.com/${c.countryCode}/flat/16.png"
              alt="${c.country}"
              class="w-4 h-3 rounded-sm flex-shrink-0"
              loading="lazy"
            />
            <div class="flex-1 min-w-0">
              <div class="text-xs font-medium text-gray-900 truncate">${c.city}, ${c.country}</div>
              <div class="text-xs text-gray-500 truncate">${c.code} â€¢ ${c.region}</div>
            </div>
          </div>
        `).join("");i.innerHTML=`
          <span class="text-xs text-gray-400 hover:text-gray-600">+${r}</span>
          <div class="all-regions-popup absolute z-30 invisible bg-white border border-gray-200 rounded-lg shadow-lg p-3 bottom-full right-0 mb-2 w-64">
            <div class="text-xs font-medium text-gray-900 mb-2">All Available Regions:</div>
            <div class="grid grid-cols-1 gap-1 max-h-40 overflow-y-auto">
              ${e}
            </div>
            <div class="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-200"></div>
          </div>
        `,i.className="relative regions-more-trigger cursor-pointer",t.appendChild(i)}}function I(t){const o=x.filter(n=>{if(t.providers?.length&&!t.providers.includes(n.provider))return!1;if(t.regions?.length){let r=!1;if(n.regionalPricing&&Array.isArray(n.regionalPricing)){const i=[];n.locationDetails&&Array.isArray(n.locationDetails)&&i.push(...n.locationDetails.filter(e=>t.regions.some(c=>c===e.country||c===e.code||c===e.region||c===e.city||c.toLowerCase()===e.country.toLowerCase()||c.toLowerCase()===e.code.toLowerCase()))),r=i.length>0&&i.some(e=>n.regionalPricing.some(c=>c.location===e.code))}else n.locationDetails&&Array.isArray(n.locationDetails)?r=n.locationDetails.some(i=>t.regions.some(e=>e===i.country||e===i.code||e===i.region||e===i.city||e.toLowerCase()===i.country.toLowerCase()||e.toLowerCase()===i.code.toLowerCase())):n.regions&&Array.isArray(n.regions)&&(r=n.regions.some(i=>t.regions.some(e=>e===i||e.toLowerCase()===i.toLowerCase())));if(!r)return!1}if(t.instanceTypes?.length&&!t.instanceTypes.includes(n.type))return!1;if(t.ipTypes?.length){const r=n.networkType||n.ipType;if(r&&!t.ipTypes.includes(r))return!1}if(t.networkOptions?.length){const r=n.networkType||n.networkOptions;if(r&&typeof r=="object"){if(!t.networkOptions.some(e=>r[e]&&r[e].available))return!1}else if(r&&typeof r=="string"&&!t.networkOptions.includes(r))return!1}if(n.vCPU<t.minVCPU||n.vCPU>t.maxVCPU||n.memoryGiB<t.minMemory||n.memoryGiB>t.maxMemory)return!1;let s=0;if(t.regions?.length===1&&n.regionalPricing&&n.locationDetails){const r=t.regions[0],i=n.locationDetails.find(e=>r===e.country||r===e.code||r.toLowerCase()===e.country.toLowerCase()||r.toLowerCase()===e.code.toLowerCase());if(i){const e=n.regionalPricing.find(c=>c.location===i.code);e&&e.hourly_net&&(s=e.hourly_net)}}if(s===0){if(n.networkOptions&&typeof n.networkOptions=="object"){const r=n.networkOptions[u];r&&r.available&&r.hourly!==null&&(s=r.hourly)}s===0&&(s=n.priceUSD_hourly||n.priceEUR_hourly_net||0)}return n.type==="cloud-server"&&n.instanceType==="cx22"&&console.log("  Final price to check:",s,"vs max price:",t.maxPrice),s>t.maxPrice?(n.type==="cloud-server"&&n.instanceType==="cx22"&&console.log("  FAILED price filter. Price:",s,"Max:",t.maxPrice),!1):(n.type==="cloud-server"&&n.instanceType==="cx22"&&console.log("  PASSED ALL FILTERS! ðŸŽ‰"),!0)});console.log(`Filtered result: ${o.length} instances`),console.log("Filtered examples:",o.slice(0,5).map(n=>({instanceType:n.instanceType,type:n.type}))),k(o),t.regions?.length===1?N(t.regions[0]):F(),y&&(y.textContent=`${o.length} instances`)}function N(t){document.querySelectorAll(".instance-row:not(.hidden)").forEach(o=>{const n=JSON.parse(o.dataset.instance||"{}");if(!n.locationDetails||!n.regionalPricing)return;const s=n.locationDetails.find(r=>t===r.country||t===r.code||t.toLowerCase()===r.country.toLowerCase()||t.toLowerCase()===r.code.toLowerCase());if(s){const r=n.regionalPricing.find(i=>i.location===s.code);if(r){const i=o.querySelector(".pricing-hourly .pricing-value");i&&r.hourly_net&&(i.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(r.hourly_net));const e=o.querySelector(".pricing-monthly .pricing-value");e&&r.monthly_net&&(e.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(r.monthly_net));const c=o.querySelector('[data-network-info="true"]');if(c){const l=c.querySelector(".pricing-description");l&&(l.textContent=`${s.city} pricing`,l.className="text-xs text-blue-600 pricing-description")}if(r.included_traffic||r.traffic_price_per_tb){const l=document.createElement("div");l.className="text-xs text-gray-500 mt-1";let a="";if(r.included_traffic){const d=(r.included_traffic/1099511627776).toFixed(1);a+=`${d}TB included`}if(r.traffic_price_per_tb&&(a&&(a+=", "),a+=`â‚¬${r.traffic_price_per_tb}/TB overage`),a){l.textContent=a;const d=o.querySelector(".pricing-hourly");d&&!d.querySelector(".traffic-info")&&(l.classList.add("traffic-info"),d.appendChild(l))}}}}})}function F(){document.querySelectorAll(".instance-row:not(.hidden)").forEach(t=>{const o=JSON.parse(t.dataset.instance||"{}");t.querySelectorAll(".traffic-info").forEach(e=>e.remove());const s=t.querySelector(".pricing-hourly .pricing-value");if(s){const e=o.priceEUR_hourly_net||o.priceUSD_hourly||0,c=o.priceEUR_hourly_net?"EUR":"USD";s.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:c,minimumFractionDigits:4}).format(e)}const r=t.querySelector(".pricing-monthly .pricing-value");if(r){const e=o.priceEUR_monthly_net||o.priceUSD_monthly||0,c=o.priceEUR_monthly_net?"EUR":"USD";r.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:c,minimumFractionDigits:2}).format(e)}const i=t.querySelector('[data-network-info="true"]');if(i){const e=i.querySelector(".pricing-description");e&&(e.textContent="Standard pricing",e.className="text-xs text-gray-500 pricing-description")}})}function _(){document.querySelectorAll('.instance-row:not([style*="display: none"])').forEach(t=>{const o=JSON.parse(t.dataset.instance||"{}");t.querySelector('[data-network-info="true"]');const n=t.querySelector(".pricing-mode-indicator"),s=t.querySelector(".pricing-description"),r=t.querySelector(".pricing-hourly"),i=t.querySelector(".pricing-monthly");if(o.networkOptions&&typeof o.networkOptions=="object"){const e=o.networkOptions[u];if(e&&e.available){if(n&&(n.textContent=u==="ipv6_only"?"IPv6-only":"IPv4 + IPv6",n.className=`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium pricing-mode-indicator ${u==="ipv6_only"?"bg-green-100 text-green-800":"bg-cyan-100 text-cyan-800"}`),s&&(u==="ipv6_only"&&e.savings?(s.textContent=`Saves â‚¬${e.savings.toFixed(2)}/month`,s.className="text-xs text-green-600 pricing-description"):(s.textContent=e.description||"Standard pricing",s.className="text-xs text-gray-500 pricing-description")),r&&e.hourly!==null){const c=r.querySelector(".pricing-value"),l=r.querySelector(".text-xs.text-orange-600");if(c){const a=e.priceRange?.hourly;if(a&&a.hasVariation){const d=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(a.min),v=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(a.max);c.textContent=`${d} - ${v}`,l&&(l.style.display="")}else c.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(e.hourly),l&&(l.style.display="none")}}if(i&&e.monthly!==null){const c=i.querySelector(".pricing-value"),l=i.querySelector(".text-xs.text-orange-600");if(c){const a=e.priceRange?.monthly;if(a&&a.hasVariation){const d=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(a.min),v=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(a.max);c.textContent=`${d} - ${v}`,l&&(l.style.display="")}else c.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(e.monthly),l&&(l.style.display="none")}}t.style.display=""}else u!=="all"&&u!=="ipv4_ipv6"&&(t.style.display="none")}})}function k(t){p&&(document.querySelectorAll(".instance-row").forEach(o=>{o.style.display="none"}),t.forEach(o=>{const n=Array.from(document.querySelectorAll(".instance-row")).find(s=>{const r=JSON.parse(s.dataset.instance||"{}");return r.instanceType===o.instanceType&&r.provider===o.provider});n&&(n.style.display="",p.appendChild(n))}),_(),b())}});document.addEventListener("DOMContentLoaded",()=>{const p=document.getElementById("apply-filters"),y=document.getElementById("clear-filters");p&&p.addEventListener("click",q),y&&y.addEventListener("click",D)});function q(){const p=Array.from(document.querySelectorAll('input[name="provider"]:checked')).map(f=>f.value),y=Array.from(document.querySelectorAll('input[name="region"]:checked')).map(f=>f.value),h=Array.from(document.querySelectorAll('input[name="instanceType"]:checked')).map(f=>f.value),g=Array.from(document.querySelectorAll('input[name="ipType"]:checked')).map(f=>f.value),x=Array.from(document.querySelectorAll('input[name="networkOption"]:checked')).map(f=>f.value),u=parseInt(document.querySelector('input[name="minVCPU"]')?.value||"0"),m=parseInt(document.querySelector('input[name="maxVCPU"]')?.value||"999"),S=parseInt(document.querySelector('input[name="minMemory"]')?.value||"0"),E=parseInt(document.querySelector('input[name="maxMemory"]')?.value||"9999"),L=parseFloat(document.querySelector('input[name="maxPrice"]')?.value||"999"),b=new CustomEvent("filtersChanged",{detail:{providers:p,regions:y,instanceTypes:h,ipTypes:g,networkOptions:x,minVCPU:u,maxVCPU:m,minMemory:S,maxMemory:E,maxPrice:L}});document.dispatchEvent(b)}function D(){document.querySelectorAll('input[type="checkbox"]').forEach(u=>{const m=u;m.name==="region"?m.checked=m.value==="Germany"||m.value==="germany":m.checked=!0});const p=document.querySelector('input[name="minVCPU"]'),y=document.querySelector('input[name="maxVCPU"]'),h=document.querySelector('input[name="minMemory"]'),g=document.querySelector('input[name="maxMemory"]'),x=document.querySelector('input[name="maxPrice"]');p&&(p.value=p.min),y&&(y.value=y.max),h&&(h.value=h.min),g&&(g.value=g.max),x&&(x.value=x.max),q()}
