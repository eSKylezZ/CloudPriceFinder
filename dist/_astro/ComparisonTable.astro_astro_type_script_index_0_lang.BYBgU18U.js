document.addEventListener("DOMContentLoaded",()=>{const b=document.getElementById("table-body"),S=document.getElementById("result-count"),g=document.getElementById("column-controls-btn"),y=document.getElementById("column-controls");let C=Array.from(document.querySelectorAll(".instance-row")).map(t=>JSON.parse(t.dataset.instance||"{}")),m="ipv4_ipv6",f="",p="asc";window.addEventListener("currencyChanged",t=>{const o=t,{currency:r,symbol:c,rates:n}=o.detail;document.querySelectorAll(".pricing-value[data-usd-price]").forEach(i=>{const e=parseFloat(i.getAttribute("data-usd-price")||"0");if(e>0){const s=n[r]||1,l=e*s;let a;if(["SEK","NOK","DKK"].includes(r))a=`${l.toFixed(2)} ${c}`;else if(r==="JPY")a=`${c}${Math.round(l)}`;else{const d=i.closest(".pricing-hourly")?4:2;a=`${c}${l.toFixed(d)}`}i.textContent=a}})}),g&&y&&(g.addEventListener("click",()=>{y.classList.toggle("hidden")}),document.addEventListener("click",t=>{!g.contains(t.target)&&!y.contains(t.target)&&y.classList.add("hidden")})),document.querySelectorAll('#column-controls input[type="checkbox"]').forEach(t=>{t.addEventListener("change",o=>{const r=o.target,c=r.id.replace("col-","col-"),n=r.checked;document.querySelectorAll(`.${c}`).forEach(e=>{n?e.classList.remove("hidden"):e.classList.add("hidden")})})}),document.querySelectorAll("th[data-sort]").forEach(t=>{t.addEventListener("click",()=>{const o=t.getAttribute("data-sort");o&&(f===o?p=p==="asc"?"desc":"asc":p="asc",f=o,L(o,p),E())})});function h(){document.querySelectorAll(".regions-more-trigger").forEach(t=>{const o=t.querySelector(".all-regions-popup");if(!o)return;let r,c;t.addEventListener("mouseenter",()=>{clearTimeout(c),r=setTimeout(()=>{o.classList.remove("invisible")},200)}),t.addEventListener("mouseleave",()=>{clearTimeout(r),c=setTimeout(()=>{o.classList.add("invisible")},300)}),o.addEventListener("mouseenter",()=>{clearTimeout(c)}),o.addEventListener("mouseleave",()=>{c=setTimeout(()=>{o.classList.add("invisible")},300)})})}h(),document.addEventListener("filtersChanged",t=>{const r=t.detail;r.networkOptions?.length===1?m=r.networkOptions[0]:m="ipv4_ipv6",F(r),r.regions?.length&&k(r.regions)});function E(){if(document.querySelectorAll(".sort-icon").forEach(o=>{o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>',o.classList.remove("text-primary-600"),o.classList.add("text-gray-400")}),f){const o=document.querySelector(`th[data-sort="${f}"] .sort-icon`);o&&(o.classList.remove("text-gray-400"),o.classList.add("text-primary-600"),p==="asc"?o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4l6 6 6-6"></path>':o.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 16l-6-6-6 6"></path>')}}function L(t,o){const c=Array.from(document.querySelectorAll(".instance-row:not(.hidden)")).map(n=>JSON.parse(n.dataset.instance||"{}"));c.sort((n,i)=>{let e=n[t],s=i[t];if(t.includes(".")){const d=t.split(".");e=d.reduce((v,x)=>v?.[x],n),s=d.reduce((v,x)=>v?.[x],i)}if(e==null&&s==null)return 0;if(e==null)return o==="asc"?1:-1;if(s==null)return o==="asc"?-1:1;if(typeof e=="string"&&typeof s=="string"){const d=e.localeCompare(s);return o==="asc"?d:-d}const l=Number(e),a=Number(s);if(!isNaN(l)&&!isNaN(a))return o==="asc"?l-a:a-l;const u=String(e).localeCompare(String(s));return o==="asc"?u:-u}),w(c)}function k(t){document.querySelectorAll(".regions-container").forEach(r=>{const c=JSON.parse(r.getAttribute("data-regions")||"[]");if(!c.length)return;const n=[...c].sort((i,e)=>{const s=t.some(a=>a===i.country||a===i.code||a===i.region),l=t.some(a=>a===e.country||a===e.code||a===e.region);return s&&!l?-1:!s&&l?1:0});N(r,n)}),h()}function N(t,o){t.innerHTML="";const c=o.slice(0,3),n=Math.max(0,o.length-3);if(c.forEach(i=>{const e=document.createElement("div");e.className="relative group",e.innerHTML=`
          <span class="inline-flex items-center space-x-1 cursor-pointer hover:bg-gray-100 px-1 py-0.5 rounded">
            <img 
              src="https://flagsapi.com/${i.countryCode}/flat/16.png"
              alt="${i.country}"
              class="w-4 h-3 rounded-sm"
              loading="lazy"
            />
            <span class="text-xs">${i.code}</span>
          </span>
          <div class="absolute z-20 invisible group-hover:visible bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-1 whitespace-nowrap">
            <div class="font-medium">${i.city}, ${i.country}</div>
            <div class="text-gray-300">${i.region}</div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
          </div>
        `,t.appendChild(e)}),n>0){const i=document.createElement("div");i.className="relative group cursor-pointer";const e=o.map(s=>`
          <div class="flex items-center space-x-2 py-1">
            <img 
              src="https://flagsapi.com/${s.countryCode}/flat/16.png"
              alt="${s.country}"
              class="w-4 h-3 rounded-sm flex-shrink-0"
              loading="lazy"
            />
            <div class="flex-1 min-w-0">
              <div class="text-xs font-medium text-gray-900 truncate">${s.city}, ${s.country}</div>
              <div class="text-xs text-gray-500 truncate">${s.code} â€¢ ${s.region}</div>
            </div>
          </div>
        `).join("");i.innerHTML=`
          <span class="text-xs text-gray-400 hover:text-gray-600">+${n}</span>
          <div class="all-regions-popup absolute z-30 invisible bg-white border border-gray-200 rounded-lg shadow-lg p-3 bottom-full right-0 mb-2 w-64">
            <div class="text-xs font-medium text-gray-900 mb-2">All Available Regions:</div>
            <div class="grid grid-cols-1 gap-1 max-h-40 overflow-y-auto">
              ${e}
            </div>
            <div class="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-200"></div>
          </div>
        `,i.className="relative regions-more-trigger cursor-pointer",t.appendChild(i)}}function F(t){const o=C.filter(r=>{if(t.providers?.length&&!t.providers.includes(r.provider))return!1;if(t.regions?.length){let n=!1;if(r.regionalPricing&&Array.isArray(r.regionalPricing)){const i=[];r.locationDetails&&Array.isArray(r.locationDetails)&&i.push(...r.locationDetails.filter(e=>t.regions.some(s=>s===e.country||s===e.code||s===e.region||s===e.city||s.toLowerCase()===e.country.toLowerCase()||s.toLowerCase()===e.code.toLowerCase()))),n=i.length>0&&i.some(e=>r.regionalPricing.some(s=>s.location===e.code))}else r.locationDetails&&Array.isArray(r.locationDetails)?n=r.locationDetails.some(i=>t.regions.some(e=>e===i.country||e===i.code||e===i.region||e===i.city||e.toLowerCase()===i.country.toLowerCase()||e.toLowerCase()===i.code.toLowerCase())):r.regions&&Array.isArray(r.regions)&&(n=r.regions.some(i=>t.regions.some(e=>e===i||e.toLowerCase()===i.toLowerCase())));if(!n)return!1}if(t.instanceTypes?.length&&!t.instanceTypes.includes(r.type))return!1;if(t.ipTypes?.length){const n=r.networkType||r.ipType;if(n&&!t.ipTypes.includes(n))return!1}if(t.networkOptions?.length){const n=r.networkType||r.networkOptions;if(n&&typeof n=="object"){if(!t.networkOptions.some(e=>n[e]&&n[e].available))return!1}else if(n&&typeof n=="string"&&!t.networkOptions.includes(n))return!1}if(r.vCPU<t.minVCPU||r.vCPU>t.maxVCPU||r.memoryGiB<t.minMemory||r.memoryGiB>t.maxMemory)return!1;let c=0;if(t.regions?.length===1&&r.regionalPricing&&r.locationDetails){const n=t.regions[0],i=r.locationDetails.find(e=>n===e.country||n===e.code||n.toLowerCase()===e.country.toLowerCase()||n.toLowerCase()===e.code.toLowerCase());if(i){const e=r.regionalPricing.find(s=>s.location===i.code);e&&e.hourly_net&&(c=e.hourly_net)}}if(c===0){if(r.networkOptions&&typeof r.networkOptions=="object"){const n=r.networkOptions[m];n&&n.available&&n.hourly!==null&&(c=n.hourly)}c===0&&(c=r.priceUSD_hourly||r.priceEUR_hourly_net||0)}return r.type==="cloud-server"&&r.instanceType==="cx22"&&console.log("  Final price to check:",c,"vs max price:",t.maxPrice),c>t.maxPrice?(r.type==="cloud-server"&&r.instanceType==="cx22"&&console.log("  FAILED price filter. Price:",c,"Max:",t.maxPrice),!1):(r.type==="cloud-server"&&r.instanceType==="cx22"&&console.log("  PASSED ALL FILTERS! ðŸŽ‰"),!0)});console.log(`Filtered result: ${o.length} instances`),console.log("Filtered examples:",o.slice(0,5).map(r=>({instanceType:r.instanceType,type:r.type}))),w(o),t.regions?.length===1?_(t.regions[0]):q(),S&&(S.textContent=`${o.length} instances`)}function _(t){document.querySelectorAll(".instance-row:not(.hidden)").forEach(o=>{const r=JSON.parse(o.dataset.instance||"{}");if(!r.locationDetails||!r.regionalPricing)return;const c=r.locationDetails.find(n=>t===n.country||t===n.code||t.toLowerCase()===n.country.toLowerCase()||t.toLowerCase()===n.code.toLowerCase());if(c){const n=r.regionalPricing.find(i=>i.location===c.code);if(n){const i=o.querySelector(".pricing-hourly .pricing-value");i&&n.hourly_net&&(i.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(n.hourly_net));const e=o.querySelector(".pricing-monthly .pricing-value");e&&n.monthly_net&&(e.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(n.monthly_net));const s=o.querySelector('[data-network-info="true"]');if(s){const l=s.querySelector(".pricing-description");l&&(l.textContent=`${c.city} pricing`,l.className="text-xs text-blue-600 pricing-description")}if(n.included_traffic||n.traffic_price_per_tb){const l=document.createElement("div");l.className="text-xs text-gray-500 mt-1";let a="";if(n.included_traffic){const u=(n.included_traffic/1099511627776).toFixed(1);a+=`${u}TB included`}if(n.traffic_price_per_tb&&(a&&(a+=", "),a+=`â‚¬${n.traffic_price_per_tb}/TB overage`),a){l.textContent=a;const u=o.querySelector(".pricing-hourly");u&&!u.querySelector(".traffic-info")&&(l.classList.add("traffic-info"),u.appendChild(l))}}}}})}function q(){document.querySelectorAll(".instance-row:not(.hidden)").forEach(t=>{const o=JSON.parse(t.dataset.instance||"{}");t.querySelectorAll(".traffic-info").forEach(e=>e.remove());const c=t.querySelector(".pricing-hourly .pricing-value");if(c){const e=o.priceEUR_hourly_net||o.priceUSD_hourly||0,s=o.priceEUR_hourly_net?"EUR":"USD";c.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:4}).format(e)}const n=t.querySelector(".pricing-monthly .pricing-value");if(n){const e=o.priceEUR_monthly_net||o.priceUSD_monthly||0,s=o.priceEUR_monthly_net?"EUR":"USD";n.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:2}).format(e)}const i=t.querySelector('[data-network-info="true"]');if(i){const e=i.querySelector(".pricing-description");e&&(e.textContent="Standard pricing",e.className="text-xs text-gray-500 pricing-description")}})}function D(){document.querySelectorAll('.instance-row:not([style*="display: none"])').forEach(t=>{const o=JSON.parse(t.dataset.instance||"{}");t.querySelector('[data-network-info="true"]');const r=t.querySelector(".pricing-mode-indicator"),c=t.querySelector(".pricing-description"),n=t.querySelector(".pricing-hourly"),i=t.querySelector(".pricing-monthly");if(o.networkOptions&&typeof o.networkOptions=="object"){const e=o.networkOptions[m];if(e&&e.available){if(r&&(r.textContent=m==="ipv6_only"?"IPv6-only":"IPv4 + IPv6",r.className=`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium pricing-mode-indicator ${m==="ipv6_only"?"bg-green-100 text-green-800":"bg-cyan-100 text-cyan-800"}`),c&&(m==="ipv6_only"&&e.savings?(c.textContent=`Saves â‚¬${e.savings.toFixed(2)}/month`,c.className="text-xs text-green-600 pricing-description"):(c.textContent=e.description||"Standard pricing",c.className="text-xs text-gray-500 pricing-description")),n&&e.hourly!==null){const s=n.querySelector(".pricing-value"),l=n.querySelector(".text-xs.text-orange-600");if(s){const a=e.priceRange?.hourly;if(a&&a.hasVariation){const u=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(a.min),d=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(a.max);s.textContent=`${u} - ${d}`,l&&(l.style.display="")}else s.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:4}).format(e.hourly),l&&(l.style.display="none")}}if(i&&e.monthly!==null){const s=i.querySelector(".pricing-value"),l=i.querySelector(".text-xs.text-orange-600");if(s){const a=e.priceRange?.monthly;if(a&&a.hasVariation){const u=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(a.min),d=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(a.max);s.textContent=`${u} - ${d}`,l&&(l.style.display="")}else s.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(e.monthly),l&&(l.style.display="none")}}t.style.display=""}else m!=="all"&&m!=="ipv4_ipv6"&&(t.style.display="none")}})}function w(t){b&&(document.querySelectorAll(".instance-row").forEach(o=>{o.style.display="none"}),t.forEach(o=>{const r=Array.from(document.querySelectorAll(".instance-row")).find(c=>{const n=JSON.parse(c.dataset.instance||"{}");return n.instanceType===o.instanceType&&n.provider===o.provider});r&&(r.style.display="",b.appendChild(r))}),D(),h())}});
